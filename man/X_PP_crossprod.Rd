% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/PP.R
\name{X_PP_crossprod}
\alias{X_PP_crossprod}
\title{Do the cross-product of the concatenation of a matrix of covariates and a PP, and a matrix
t(X|PP) %*% Y}
\usage{
X_PP_crossprod(X, PP = NULL, Y, vecchia_approx, permutate_PP_to_obs = F)
}
\arguments{
\item{X}{a matrix of covariates who will be multiplied by the first rows of Y}

\item{PP}{either a PP whose basis will be multiplied by the last columns of Y}

\item{Y}{the matrix who multiplies the covariates and the PP}

\item{locs_idx}{either a vector of integers who dispatch the PP basis to the covariates, or NULL}
}
\value{
a matrix
}
\description{
Do the cross-product of the concatenation of a matrix of covariates and a PP, and a matrix
t(X|PP) %*% Y
}
\examples{
locs = cbind(runif(5000), runif(5000))
locs = rbind(locs, locs)
vecchia_approx = createVecchia(locs)
PP = createPP(vecchia_approx)

# just surrogate of crossprod
X = matrix(rnorm(100000), 10000)
Y = matrix(rnorm(30*nrow(X)), nrow(X))
res1 <- X_PP_crossprod(X = X, PP = NULL, Y = Y, vecchia_approx = vecchia_approx)
crossprod(X, Y) - res1

# crossprod + PP with observations of X on the locs
X = matrix(rnorm(20*vecchia_approx$n_locs), vecchia_approx$n_locs)
Y = matrix(rnorm(30*nrow(X)), nrow(X))
res2 <- X_PP_crossprod(X = X, PP = PP, Y = Y, vecchia_approx = vecchia_approx, permutate_PP_to_obs = F)
hist(as.vector(res2 - crossprod(
 cbind(X, Matrix::solve(PP$sparse_chol, diag(1, nrow(PP$sparse_chol), PP$n_knots))[-seq(PP$n_knots),]), Y
)))

# crossprod + PP with PP dispatched to observations of X
X = matrix(rnorm(20*vecchia_approx$n_obs), vecchia_approx$n_obs)
Y = matrix(rnorm(30*nrow(X)), nrow(X))
res2 <- X_PP_crossprod(X = X, PP = PP, Y = Y, vecchia_approx = vecchia_approx, permutate_PP_to_obs = T)
hist(as.vector(res2 - crossprod(
 cbind(X, Matrix::solve(PP$sparse_chol, diag(1, nrow(PP$sparse_chol), PP$n_knots))[-seq(PP$n_knots),][vecchia_approx$locs_match,]), Y
)))
}
